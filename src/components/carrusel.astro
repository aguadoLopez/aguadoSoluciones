<section id="carrusel" class="carousel-section bg-slate-500 h-44">
  <div class="flex flex-row justify-center items-center md:gap-5 w-screen">
    <button class="text-azul1 font-bold" id="prevBtn">
      <span class="text-xl">&lt;</span>
    </button>

    <div class="carousel-container md:w-[600px] w-3/5 overflow-hidden mx-8">
      <div id="carousel-items" class="carousel-items flex transition-transform duration-300 ease-in-out">
        <!-- Elementos del carrusel se insertan dinámicamente -->
      </div>
    </div>

    <button class="text-azul1 font-bold" id="nextBtn">
      <span class="text-xl">&gt;</span>
    </button>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const carouselItems = document.getElementById('carousel-items');
    const container = document.querySelector('.carousel-container') as HTMLElement;


    let currentIndex = 0;

    function updateCarousel() {
      if (container instanceof HTMLElement && carouselItems instanceof HTMLElement) {
        const width = container.offsetWidth;
        carouselItems.style.transform = `translateX(-${currentIndex * width}px)`;
      }
    }

    if (prevBtn && nextBtn && carouselItems && container) {
      prevBtn.addEventListener('click', () => {
        const itemCount = carouselItems.children.length;
        currentIndex = (currentIndex - 1 + itemCount) % itemCount;
        updateCarousel();
      });

      nextBtn.addEventListener('click', () => {
        const itemCount = carouselItems.children.length;
        currentIndex = (currentIndex + 1) % itemCount;
        updateCarousel();
      });

      window.addEventListener('resize', () => {
        // Reajustar tamaños al cambiar el ancho de la ventana
        const containerWidth = container.offsetWidth;
        document.querySelectorAll('.carousel-item').forEach(item => {
          (item as HTMLElement).style.width = `${containerWidth}px`;
        });
        updateCarousel();
      });

      // Cargar contenido dinámicamente
      fetch(`http://localhost:4321/api/servicios?page=1&limit=5`)
        .then(response => response.json())
        .then(data => {
          const servicios = data.servicios;
          carouselItems.innerHTML = servicios.map(servicio => `
            <div class="carousel-item flex-shrink-0 h-80 bg-center rounded-lg justify-center items-center flex"
                 style="background-image: url('${servicio.imagen}'); background-size: cover;">
              <div class="text-center text-white">
                <h3 class="text-3xl font-bold mb-2">Aguado</h3>
                <h3 class="text-3xl font-bold mb-2">Soluciones</h3>
              </div>
            </div>
          `).join('');

          // Asegurar que cada item tenga el mismo ancho que el contenedor
          const containerWidth = container.offsetWidth;
          document.querySelectorAll('.carousel-item').forEach(item => {
            (item as HTMLElement).style.width = `${containerWidth}px`;
          });

          updateCarousel();
        });
    }
  });
</script>
